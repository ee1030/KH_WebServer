<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="searchMapper">

	<resultMap type="Board" id="board_rm">
		<id property="boardNo" column="BOARD_NO"/>
		
		<result property="boardTitle" column="BOARD_TITLE"/>
		<result property="boardContent" column="BOARD_CONTENT"/>
		<result property="memberId" column="MEMBER_ID"/>
		<result property="readCount" column="READ_COUNT"/>
		<result property="categoryName" column="CATEGORY_NM"/>
		<result property="boardCreateDate" column="BOARD_CREATE_DT"/>
		<result property="boardModifyDate" column="BOARD_MODIFY_DT"/>
		<result property="boardStatus" column="BOARD_STATUS"/>
	</resultMap>
	
	<!-- 조건에 맞는 전체 게시글 수 조회(select / 단일 행 / resultType="_int") -->
	<select id="getListCount" parameterType="map" resultType="_int">
		SELECT COUNT(*) FROM V_BOARD
		WHERE BOARD_STATUS = 'Y'
		
		<!-- 동적 SQL(if) -->
		<if test="searchKey == 'title'">		
			AND BOARD_TITLE LIKE '%' || #{searchValue} || '%'
		</if>
		<if test="searchKey == 'content'">		
			AND BOARD_CONTENT LIKE '%' || #{searchValue} || '%'
		</if>
		<if test="searchKey == 'titcont'">		
			AND (BOARD_TITLE LIKE '%' || #{searchValue} || '%'
				OR BOARD_CONTENT LIKE '%' || #{searchValue} || '%')
		</if>
		<if test="searchKey == 'writer'">		
			AND MEMBER_ID LIKE '%' || #{searchValue} || '%'
		</if>
		
	</select>
	
	<!-- 조건이 일치하는 게시글 목록 조회(select / 다중행 / map / board_rm) -->
	<select id="searchBoardList" parameterType="map" resultMap="board_rm">
		SELECT * FROM V_BOARD WHERE BOARD_STATUS = 'Y'
		
		<!-- 동적 SQL(choose, when, otherwise) -->
		<choose>
			<when test="searchKey == 'title'">		
			AND BOARD_TITLE LIKE '%' || #{searchValue} || '%'
			</when>
			<when test="searchKey == 'content'">		
				AND BOARD_CONTENT LIKE '%' || #{searchValue} || '%'
			</when>
			<when test="searchKey == 'titcont'">		
				AND (BOARD_TITLE LIKE '%' || #{searchValue} || '%'
					OR BOARD_CONTENT LIKE '%' || #{searchValue} || '%')
			</when>
			<otherwise>		
				AND MEMBER_ID LIKE '%' || #{searchValue} || '%'
			</otherwise>
		</choose>
		
	</select>
	
</mapper>